import zipfile
import os
import sys
from distutils.core import setup

import folium
import requests
import py2exe
from matplotlib import get_py2exe_datafiles

#ERROR missing module in previous compilation
#['Carbon', 'Carbon.Files', 'Cython', 'ElementC14N', 'IPython.config.Application', 'IPython.config.Configurable', 'IPython.config.LoggingConfigurable', 'IPython.kernel.comm.CommManager', 'IPython.kernel.connect_qtconsole', 'IPython.kernel.get_connection_file', 'IPython.kernel.get_connection_info', 'IPython.kernel.launch_kernel', 'IPython.kernel.make_ipkernel_cmd', 'IPython.kernel.write_connection_file', 'Image', 'ImageFilter', 'IronPython.Runtime.Exceptions', 'IronPythonConsole', 'Levenshtein', 'Numeric', 'OpenGL.platform.CurrentContextIsValid', 'OpenGL.platform.GLUT_GUARD_CALLBACKS', 'OpenGL.platform.PLATFORM', 'OpenGL.platform.createBaseFunction', 'PIL._imagingagg', 'PyQt5', 'PyQt5.QtWidgets', 'PySide', 'PySide.QtCore', 'PySide.QtGui', 'System', 'System.Windows.Forms.Clipboard', '__pypy__', '__svn_version__', '_datetime', '_imaging_gif', '_imp', '_implementation', '_scproxy', '_structseq', '_sysconfigdata', '_winapi', 'apiclient.discovery', 'apiclient.errors', 'appnope', 'backports.configparser', 'backports.ssl_match_hostname', 'blocking.BlockingKernelClient', 'boto', 'builder.ParserRejectedMarkup', 'builder.builder_registry', 'cffi._pycparser', 'charade', 'charade.universaldetector', 'clr', 'code_generators.genapi', 'code_generators.numpy_api', 'collections.abc', 'com.sun', 'com.sun.jna', 'com.sun.jna.platform', 'compat.long', 'console', 'core.abs', 'core.max', 'core.min', 'core.round', 'cryptography.hazmat.bindings._commoncrypto', 'csgraph.cs_graph_components', 'ctags', 'cvxopt', 'dateutil.tz.tzfile', 'dbm.dumb', 'dbm.gnu', 'dbm.ndbm', 'denest2', 'dialects.registry', 'dill', 'dummy.Process', 'engine.Connectable', 'engine.Dialect', 'engine.Engine', 'engine.create_engine', 'engine.engine_from_config', 'fcompiler.FCompiler', 'fcompiler.has_f90_header', 'fcompiler.is_f_file', 'gdbm', 'genapi', 'genshi.core', 'geopy.version', 'gi.repository', 'glut_support', 'gobject', 'grant_types.AuthorizationCodeGrant', 'grant_types.ClientCredentialsGrant', 'grant_types.ImplicitGrant', 'grant_types.RefreshTokenGrant', 'grant_types.ResourceOwnerPasswordCredentialsGrant', 'gssapi', 'gtk', 'harwell_boeing.hb_read', 'harwell_boeing.hb_write', 'httplib2', 'iconv_codec', 'importlib.machinery', 'java', 'jinja2.debugrenderer', 'joblib', 'linalg.norm', 'matlab.loadmat', 'matlab.savemat', 'matlab.whosmat', 'matplotlib.axes.Axes', 'matplotlib.axes.Subplot', 'matplotlib.axes.SubplotBase', 'matplotlib.axes.subplot_class_factory', 'matplotlib.backends._macosx', 'matplotlib.externals.six.moves.urllib.parse', 'matplotlib.externals.six.moves.urllib.request', 'matplotlib.tri.Triangulation', 'modes.editingmodes', 'monotime', 'mpl_toolkits.natgrid', 'nose.tools.assert_raises', 'numarray', 'numdifftools', 'numpy.Inf', 'numpy.NINF', 'numpy.NaN', 'numpy._build_utils.apple_accelerate', 'numpy.absolute', 'numpy.add', 'numpy.all', 'numpy.allclose', 'numpy.alltrue', 'numpy.amax', 'numpy.amin', 'numpy.angle', 'numpy.any', 'numpy.append', 'numpy.arange', 'numpy.arccos', 'numpy.arccosh', 'numpy.arcsin', 'numpy.arcsinh', 'numpy.arctan', 'numpy.arctan2', 'numpy.arctanh', 'numpy.argmax', 'numpy.argmin', 'numpy.argsort', 'numpy.around', 'numpy.array', 'numpy.array_equal', 'numpy.asanyarray', 'numpy.asarray', 'numpy.asarray_chkfinite', 'numpy.ascontiguousarray', 'numpy.asfarray', 'numpy.asmatrix', 'numpy.atleast_1d', 'numpy.atleast_2d', 'numpy.bool_', 'numpy.cast', 'numpy.ceil', 'numpy.column_stack', 'numpy.compat.asbytes', 'numpy.compat.asbytes_nested', 'numpy.compat.asstr', 'numpy.compat.basestring', 'numpy.compat.bytes', 'numpy.compat.integer_types', 'numpy.compat.isfileobj', 'numpy.compat.long', 'numpy.compat.npy_load_module', 'numpy.compat.open_latin1', 'numpy.compat.sixu', 'numpy.compat.unicode', 'numpy.complex_', 'numpy.compress', 'numpy.concatenate', 'numpy.conj', 'numpy.conjugate', 'numpy.copy', 'numpy.core.Inf', 'numpy.core.absolute', 'numpy.core.add', 'numpy.core.all', 'numpy.core.amax', 'numpy.core.amin', 'numpy.core.any', 'numpy.core.arange', 'numpy.core.around', 'numpy.core.array', 'numpy.core.array_repr', 'numpy.core.asanyarray', 'numpy.core.asarray', 'numpy.core.atleast_1d', 'numpy.core.atleast_2d', 'numpy.core.atleast_3d', 'numpy.core.bitwise_and', 'numpy.core.bitwise_or', 'numpy.core.bitwise_xor', 'numpy.core.broadcast', 'numpy.core.cdouble', 'numpy.core.complexfloating', 'numpy.core.concatenate', 'numpy.core.conjugate', 'numpy.core.csingle', 'numpy.core.divide', 'numpy.core.dot', 'numpy.core.double', 'numpy.core.empty', 'numpy.core.empty_like', 'numpy.core.equal', 'numpy.core.errstate', 'numpy.core.fastCopyAndTranspose', 'numpy.core.finfo', 'numpy.core.float32', 'numpy.core.float64', 'numpy.core.float_', 'numpy.core.geterrobj', 'numpy.core.greater', 'numpy.core.greater_equal', 'numpy.core.hstack', 'numpy.core.iinfo', 'numpy.core.inexact', 'numpy.core.inf', 'numpy.core.intc', 'numpy.core.integer', 'numpy.core.intp', 'numpy.core.invert', 'numpy.core.isfinite', 'numpy.core.isinf', 'numpy.core.isnan', 'numpy.core.isscalar', 'numpy.core.left_shift', 'numpy.core.less', 'numpy.core.less_equal', 'numpy.core.linspace', 'numpy.core.longdouble', 'numpy.core.maximum', 'numpy.core.multiply', 'numpy.core.ndarray', 'numpy.core.newaxis', 'numpy.core.not_equal', 'numpy.core.number', 'numpy.core.object_', 'numpy.core.ones', 'numpy.core.power', 'numpy.core.product', 'numpy.core.ravel', 'numpy.core.remainder', 'numpy.core.reshape', 'numpy.core.result_type', 'numpy.core.right_shift', 'numpy.core.rollaxis', 'numpy.core.shape', 'numpy.core.signbit', 'numpy.core.sin', 'numpy.core.single', 'numpy.core.size', 'numpy.core.sqrt', 'numpy.core.subtract', 'numpy.core.sum', 'numpy.core.swapaxes', 'numpy.core.take', 'numpy.core.transpose', 'numpy.core.ufunc', 'numpy.core.vstack', 'numpy.core.zeros', 'numpy.cos', 'numpy.cosh', 'numpy.deprecate', 'numpy.diag', 'numpy.diag_indices', 'numpy.diff', 'numpy.divide', 'numpy.dot', 'numpy.double', 'numpy.dtype', 'numpy.empty', 'numpy.errstate', 'numpy.exp', 'numpy.expand_dims', 'numpy.expm1', 'numpy.extract', 'numpy.eye', 'numpy.fft.fft', 'numpy.fft.ifft', 'numpy.fft.irfft', 'numpy.fft.irfftn', 'numpy.fft.rfftn', 'numpy.finfo', 'numpy.flatnonzero', 'numpy.float64', 'numpy.float_', 'numpy.floor', 'numpy.fmod', 'numpy.frombuffer', 'numpy.fromfile', 'numpy.fromstring', 'numpy.greater', 'numpy.greater_equal', 'numpy.histogramdd', 'numpy.hstack', 'numpy.identity', 'numpy.iinfo', 'numpy.imag', 'numpy.inexact', 'numpy.inf', 'numpy.info', 'numpy.infty', 'numpy.inner', 'numpy.int32', 'numpy.int64', 'numpy.int_', 'numpy.intc', 'numpy.integer', 'numpy.intp', 'numpy.iscomplex', 'numpy.iscomplexobj', 'numpy.isfinite', 'numpy.isinf', 'numpy.isnan', 'numpy.isscalar', 'numpy.issubdtype', 'numpy.kron', 'numpy.less', 'numpy.lib.add_newdoc', 'numpy.lib.asfarray', 'numpy.lib.i0', 'numpy.lib.imag', 'numpy.lib.iscomplexobj', 'numpy.lib.real', 'numpy.lib.triu', 'numpy.linalg.LinAlgError', 'numpy.linalg.cholesky', 'numpy.linalg.eigvals', 'numpy.linalg.inv', 'numpy.linalg.lstsq', 'numpy.linalg.norm', 'numpy.linalg.pinv', 'numpy.linalg.slogdet', 'numpy.linalg.solve', 'numpy.linspace', 'numpy.little_endian', 'numpy.log', 'numpy.log10', 'numpy.log1p', 'numpy.log2', 'numpy.logical_and', 'numpy.logical_not', 'numpy.logical_or', 'numpy.logspace', 'numpy.ma.MAError', 'numpy.ma.MaskedArray', 'numpy.ma.filled', 'numpy.ma.getdata', 'numpy.ma.getmaskarray', 'numpy.ma.make_mask_descr', 'numpy.ma.masked', 'numpy.ma.masked_array', 'numpy.ma.nomask', 'numpy.matrix', 'numpy.mean', 'numpy.median', 'numpy.mgrid', 'numpy.minimum', 'numpy.mintypecode', 'numpy.mod', 'numpy.multiply', 'numpy.nan', 'numpy.nan_to_num', 'numpy.nanmax', 'numpy.nanmean', 'numpy.nanmedian', 'numpy.nanmin', 'numpy.nanstd', 'numpy.nansum', 'numpy.nanvar', 'numpy.ndarray', 'numpy.newaxis', 'numpy.nonzero', 'numpy.not_equal', 'numpy.ones', 'numpy.ones_like', 'numpy.outer', 'numpy.percentile', 'numpy.pi', 'numpy.piecewise', 'numpy.place', 'numpy.poly', 'numpy.poly1d', 'numpy.polyadd', 'numpy.polyder', 'numpy.polydiv', 'numpy.polyint', 'numpy.polymul', 'numpy.polysub', 'numpy.polyval', 'numpy.power', 'numpy.prod', 'numpy.product', 'numpy.putmask', 'numpy.r_', 'numpy.random.multivariate_normal', 'numpy.random.rand', 'numpy.random.randint', 'numpy.random.randn', 'numpy.random.random_sample', 'numpy.ravel', 'numpy.real', 'numpy.real_if_close', 'numpy.rec', 'numpy.recarray', 'numpy.recfromtxt', 'numpy.reshape', 'numpy.resize', 'numpy.rollaxis', 'numpy.roots', 'numpy.savetxt', 'numpy.searchsorted', 'numpy.shape', 'numpy.sign', 'numpy.sin', 'numpy.sinc', 'numpy.single', 'numpy.sinh', 'numpy.sometrue', 'numpy.sort', 'numpy.source', 'numpy.sqrt', 'numpy.square', 'numpy.squeeze', 'numpy.subtract', 'numpy.sum', 'numpy.swapaxes', 'numpy.take', 'numpy.tan', 'numpy.tanh', 'numpy.testing.assert_allclose', 'numpy.testing.assert_almost_equal', 'numpy.testing.assert_array_almost_equal', 'numpy.testing.assert_array_equal', 'numpy.testing.assert_equal', 'numpy.transpose', 'numpy.trapz', 'numpy.tril_indices', 'numpy.triu', 'numpy.triu_indices', 'numpy.uint16', 'numpy.uint8', 'numpy.unique', 'numpy.vdot', 'numpy.vectorize', 'numpy.vstack', 'numpy.where', 'numpy.who', 'numpy.zeros', 'numpy.zeros_like', 'numpy_api', 'numpy_distutils', 'numpy_distutils.command.build_flib', 'numpy_distutils.command.cpuinfo', 'numpy_distutils.cpuinfo', 'numpy_distutils.fcompiler', 'oauth2client.client', 'oauth2client.file', 'oauth2client.tools', 'oauthlib.oauth2.InsecureTransportError', 'oauthlib.oauth2.TokenExpiredError', 'openpyxl', 'openpyxl.cell', 'openpyxl.style', 'openpyxl.styles', 'openpyxl.workbook', 'ordereddict', 'org.python.modules.posix.PosixModule', 'packages.six.moves', 'packages.six.moves.http_client', 'packages.six.moves.urllib.parse', 'packages.ssl_match_hostname.CertificateError', 'packages.ssl_match_hostname.match_hostname', 'packages.urllib3.util.Timeout', 'packages.urllib3.util.parse_url', 'pandas.DateRange', 'path', 'patsy.DesignInfo', 'patsy.DesignMatrix', 'patsy.EvalEnvironment', 'patsy.NAAction', 'patsy.dmatrices', 'patsy.dmatrix', 'pexpect', 'plugins.ImageOverlay', 'porterstemmer', 'pretty', 'pudb', 'pyczmq', 'pydb', 'pydb.fns', 'pyglet', 'pygments.formatters.HtmlFormatter', 'pygments.formatters.LatexFormatter', 'pygments.formatters.TerminalFormatter', 'pygments.lexers.CLexer', 'pygments.lexers.PythonConsoleLexer', 'pygments.lexers.PythonLexer', 'pygments.lexers.RstLexer', 'pygments.lexers.TextLexer', 'pyreadline.keysyms.make_KeyPress', 'pyreadline.keysyms.make_KeyPress_from_keydescr', 'pyreadline.keysyms.make_keyinfo', 'pyreadline.keysyms.make_keysym', 'pysqlite2', 'reprlib.recursive_repr', 'resource', 'rfc5849.Client', 'rfc5849.SIGNATURE_HMAC', 'rfc5849.SIGNATURE_PLAINTEXT', 'rfc5849.SIGNATURE_RSA', 'rfc5849.SIGNATURE_TYPE_AUTH_HEADER', 'rfc5849.SIGNATURE_TYPE_BODY', 'rfc5849.SIGNATURE_TYPE_QUERY', 'rfc5849.endpoints.AccessTokenEndpoint', 'rfc5849.endpoints.AuthorizationEndpoint', 'rfc5849.endpoints.RequestTokenEndpoint', 'rfc5849.endpoints.ResourceEndpoint', 'rfc5849.endpoints.SignatureOnlyEndpoint', 'rfc5849.endpoints.WebApplicationServer', 'rfc6749.clients.BackendApplicationClient', 'rfc6749.clients.Client', 'rfc6749.clients.LegacyApplicationClient', 'rfc6749.clients.MobileApplicationClient', 'rfc6749.clients.ServiceApplicationClient', 'rfc6749.clients.WebApplicationClient', 'rfc6749.endpoints.AuthorizationEndpoint', 'rfc6749.endpoints.BackendApplicationServer', 'rfc6749.endpoints.LegacyApplicationServer', 'rfc6749.endpoints.MobileApplicationServer', 'rfc6749.endpoints.ResourceEndpoint', 'rfc6749.endpoints.RevocationEndpoint', 'rfc6749.endpoints.Server', 'rfc6749.endpoints.TokenEndpoint', 'rfc6749.endpoints.WebApplicationServer', 'rfc6749.grant_types.AuthorizationCodeGrant', 'rfc6749.grant_types.ClientCredentialsGrant', 'rfc6749.grant_types.ImplicitGrant', 'rfc6749.grant_types.RefreshTokenGrant', 'rfc6749.grant_types.ResourceOwnerPasswordCredentialsGrant', 'roman', 'scikits.statsmodels.api', 'scikits.timeseries', 'scikits.umfpack', 'scipy._build_utils.get_g77_abi_wrappers', 'scipy._build_utils.get_sgemv_fix', 'scipy.arange', 'scipy.exp', 'scipy.fftpack.fft', 'scipy.fftpack.fft2', 'scipy.fftpack.fftfreq', 'scipy.fftpack.fftn', 'scipy.fftpack.ifft', 'scipy.fftpack.ifft2', 'scipy.fftpack.ifftn', 'scipy.fftpack.ifftshift', 'scipy.info', 'scipy.interpolate.BPoly', 'scipy.interpolate.PPoly', 'scipy.interpolate.interp1d', 'scipy.interpolate.interp2d', 'scipy.interpolate.splev', 'scipy.linalg.LinAlgError', 'scipy.linalg._cblas', 'scipy.linalg._clapack', 'scipy.linalg.block_diag', 'scipy.linalg.cho_factor', 'scipy.linalg.cho_solve', 'scipy.linalg.cholesky', 'scipy.linalg.eigh', 'scipy.linalg.get_blas_funcs', 'scipy.linalg.inv', 'scipy.linalg.lstsq', 'scipy.linalg.lu_factor', 'scipy.linalg.lu_solve', 'scipy.linalg.norm', 'scipy.linalg.pinv', 'scipy.linalg.qr', 'scipy.linalg.solve', 'scipy.linalg.solve_triangular', 'scipy.linalg.svd', 'scipy.linalg.svdvals', 'scipy.linalg.toeplitz', 'scipy.linspace', 'scipy.misc.derivative', 'scipy.ndimage.convolve1d', 'scipy.ones', 'scipy.optimize.OptimizeResult', 'scipy.optimize.approx_fprime', 'scipy.optimize.brent', 'scipy.optimize.fmin', 'scipy.optimize.fmin_bfgs', 'scipy.optimize.fmin_cg', 'scipy.optimize.fmin_ncg', 'scipy.optimize.fminbound', 'scipy.optimize.minimize', 'scipy.pi', 'scipy.signal.convolve', 'scipy.signal.fftconvolve', 'scipy.signal.lfilter', 'scipy.sparse.SparseEfficiencyWarning', 'scipy.sparse.bmat', 'scipy.sparse.coo_matrix', 'scipy.sparse.csc_matrix', 'scipy.sparse.csr_matrix', 'scipy.sparse.dia_matrix', 'scipy.sparse.eye', 'scipy.sparse.isspmatrix', 'scipy.sparse.isspmatrix_csc', 'scipy.sparse.isspmatrix_csr', 'scipy.sparse.linalg.LinearOperator', 'scipy.sparse.linalg.aslinearoperator', 'scipy.sparse.linalg.gmres', 'scipy.sparse.linalg.onenormest', 'scipy.sparse.linalg.splu', 'scipy.sparse.linalg.spsolve', 'scipy.sparse.linalg.svds', 'scipy.sparse.spdiags', 'scipy.sparse.spmatrix', 'scipy.spatial.cKDTree', 'scipy.special.beta', 'scipy.special.boxcox', 'scipy.special.boxcox1p', 'scipy.special.chndtr', 'scipy.special.comb', 'scipy.special.entr', 'scipy.special.erf', 'scipy.special.factorial', 'scipy.special.factorial2', 'scipy.special.factorialk', 'scipy.special.gamma', 'scipy.special.gammaln', 'scipy.special.hyp0f1', 'scipy.special.kl_div', 'scipy.special.sinc', 'scipy.stats.chi', 'scipy.stats.chi2', 'scipy.stats.f', 'scipy.stats.gmean', 'scipy.stats.hmean', 'scipy.stats.kendalltau', 'scipy.stats.kurtosis', 'scipy.stats.nbinom', 'scipy.stats.norm', 'scipy.stats.rankdata', 'scipy.stats.rv_continuous', 'scipy.stats.scoreatpercentile', 'scipy.stats.skew', 'scipy.stats.spearmanr', 'scipy.stats.ss', 'scipy.stats.t', 'scipy.stats.zscore', 'serializer.serialize', 'simplegeneric', 'simplejson', 'sitecustomize', 'six.moves.urllib', 'socks', 'sql.alias', 'sql.and_', 'sql.asc', 'sql.between', 'sql.bindparam', 'sql.case', 'sql.cast', 'sql.collate', 'sql.column', 'sql.delete', 'sql.desc', 'sql.distinct', 'sql.except_', 'sql.except_all', 'sql.exists', 'sql.extract', 'sql.false', 'sql.func', 'sql.funcfilter', 'sql.insert', 'sql.intersect', 'sql.intersect_all', 'sql.join', 'sql.literal', 'sql.literal_column', 'sql.modifier', 'sql.not_', 'sql.null', 'sql.or_', 'sql.outerjoin', 'sql.outparam', 'sql.over', 'sql.select', 'sql.subquery', 'sql.table', 'sql.text', 'sql.true', 'sql.tuple_', 'sql.type_coerce', 'sql.union', 'sql.union_all', 'sql.update', 'startup', 'statsmodels.compat.range', 'statsmodels.datasets.stackloss.load', 'test.support', 'testing.Tester', 'testing.test', 'testing.udir', 'treebuilders.getTreeBuilder', 'treewalkers.getTreeWalker', 'tri.LinearTriInterpolator', 'tri.Triangulation', 'trie.Trie', 'unittest._WritelnDecorator', 'unittest.mock', 'urllib.error', 'urllib.parse', 'urllib.request', 'usercustomize', 'util.chop_traceback', 'util.memoized_property', 'util.pickle', 'util.threading', 'win32com.shell', 'xlrd', 'xlsxwriter', 'xlwt', 'zmq.EAGAIN', 'zmq.ETERM', 'zmq.PUB', 'zmq.QUEUE', 'zmq.backend.Context', 'zmq.backend.Frame', 'zmq.backend.Socket', 'zmq.backend.constants', 'zmq.backend.strerror', 'zmq.backend.zmq_errno', 'zmq.backend.zmq_poll', 'zmq.backend.zmq_version_info', 'zmq.device', 'zmq.libzmq', 'IPython.external.appnope.nap', 'IPython.external.appnope.nope', 'IPython.external.appnope.nope_scope', 'IPython.external.simplegeneric.generic', '_thread.RLock', '_thread.allocate_lock', '_thread.get_ident', '_thread.interrupt_main', 'builtins.bool', 'builtins.complex', 'builtins.float']

#https://github.com/folium/folium/issues/799 : same issus with folium for folium (jinja2)
current_dir = os.path.dirname(os.path.realpath(__file__))
dist_dir = os.path.join(current_dir, "dist")

import matplotlib

setup(windows =['Launcher.py'],
      options = {'py2exe':
                 {'bundle_files': 1,
                  'compressed': True,
                  'includes': ['folium','jinja2','numpy'],
                  'packages': [ 'pkg_resources' ],
                  'dist_dir': dist_dir,}
                 },
      data_files= matplotlib.get_py2exe_datafiles()+['cacert.pem'],
      )

# Add folium/templates files to the library.zip file
#zip library
zipfile_path = os.path.join(dist_dir, "library.zip")
z = zipfile.ZipFile(zipfile_path, 'a')
#folium
folium_path = sys.modules['folium'].__path__[0]
for dirpath,dirs,files in os.walk(os.path.join(folium_path, 'templates')):
  for f in files:
      fn = os.path.join(dirpath, f)
      z.write(fn, os.path.join(dirpath[dirpath.index('folium'):], f))

z.close()
